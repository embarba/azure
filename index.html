<script>
  const storageAccountName = "embarba1990";
  const containerName = "webstaticembarba";
  const blobListElement = document.getElementById('blob-list');

  async function loadBlobs() {
    try {
      const url = `https://${storageAccountName}.blob.core.windows.net/${containerName}?restype=container&comp=list`;
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const text = await response.text();
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(text, "application/xml");
      const blobs = xmlDoc.getElementsByTagName('Blob');

      blobListElement.innerHTML = ''; // Limpia el "Cargando ficheros..."

      for (let blob of blobs) {
        const name = blob.getElementsByTagName('Name')[0].textContent;
        const blobUrl = `https://${storageAccountName}.blob.core.windows.net/${containerName}/${name}`;
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = blobUrl;
        link.textContent = name;
        link.target = "_blank";
        li.appendChild(link);
        blobListElement.appendChild(li);
      }

      if (blobs.length === 0) {
        blobListElement.innerHTML = '<li>No hay ficheros disponibles.</li>';
      }

    } catch (error) {
      console.error('Error al cargar blobs:', error);
      blobListElement.innerHTML = '<li>Error cargando ficheros.</li>';
    }
  }

  // Llama a la función al cargar la página
  window.onload = loadBlobs;
</script>